<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 5 Chunks Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600;800&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lexend', 'Noto Sans TC', sans-serif; background: #fefce8; }
        .chunk-highlight { color: #8b5cf6; font-weight: 800; text-decoration: underline; text-underline-offset: 4px; }
        .tab-active { background: #8b5cf6; color: white; transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .btn-check { transition: all 0.2s; border-width: 2px; }
        .btn-check:active { transform: scale(0.95); }
        .screenshot-area { background: white; border: 2px solid #e2e8f0; padding: 2rem; border-radius: 1.5rem; }
    </style>
</head>
<body class="min-h-screen pb-20">

    <nav class="bg-white border-b sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
            <h1 class="text-xl font-bold text-violet-800 flex items-center">
                <span class="mr-2 text-2xl">ğŸ“š</span> Lesson 5 èªå¡Šå°ˆå®¶
            </h1>
            <div class="flex space-x-1 bg-slate-100 p-1 rounded-xl text-sm">
                <button onclick="switchMode('list')" id="btn-mode-list" class="px-4 py-2 rounded-lg font-bold transition tab-active">å…¨éƒ¨ä¾‹å¥</button>
                <button onclick="switchMode('quiz')" id="btn-mode-quiz" class="px-4 py-2 rounded-lg font-bold transition text-slate-500">èªå¡ŠæŒ‘æˆ°</button>
            </div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 pt-8">

        <!-- Mode: List View -->
        <div id="mode-list" class="mode-content space-y-4">
            <div class="bg-violet-50 p-4 rounded-2xl border border-violet-100 mb-6 flex items-center">
                <span class="text-2xl mr-3">ğŸ’¡</span>
                <p class="text-violet-900 text-sm font-medium">é€™æ˜¯ç¬¬ 5 èª²å®Œæ•´çš„ 29 å¥ç·´ç¿’ï¼æŒ‘æˆ°æ¨¡å¼æœƒéš¨æ©ŸæŠ½å‡º 10 é¡Œå–”ï¼</p>
            </div>
            <div id="list-container" class="space-y-4"></div>
        </div>

        <!-- Mode: Quiz Challenge -->
        <div id="mode-quiz" class="mode-content hidden">
            <!-- Name Input Stage -->
            <div id="quiz-auth" class="bg-white rounded-3xl card-shadow p-10 text-center border border-slate-100">
                <h2 class="text-2xl font-bold text-slate-800 mb-4">æº–å‚™å¥½é–‹å§‹æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
                <p class="text-slate-500 mb-8">è«‹è¼¸å…¥ä½ çš„å§“åä»¥é–‹å§‹ 10 é¡Œéš¨æ©ŸæŒ‘æˆ°ï¼š</p>
                <input type="text" id="student-name" placeholder="è«‹è¼¸å…¥å§“å" class="w-full max-w-xs mx-auto block p-4 border-2 border-slate-200 rounded-xl mb-6 focus:border-violet-400 focus:outline-none font-bold text-center text-lg">
                <button onclick="initQuizSession()" class="bg-violet-500 text-white px-12 py-4 rounded-xl font-black shadow-lg hover:bg-violet-600 transition text-lg">é–‹å§‹æŒ‘æˆ°</button>
            </div>

            <!-- Quiz Play Stage -->
            <div id="quiz-play" class="hidden">
                <div class="bg-white rounded-3xl card-shadow p-8 mb-8 border border-slate-100">
                    <div class="flex justify-between items-center mb-8">
                        <span id="quiz-progress" class="font-black text-violet-700 bg-violet-50 px-4 py-1.5 rounded-full text-sm tracking-widest">STEP 1/10</span>
                        <div class="text-right">
                            <p id="quiz-user-display" class="text-xs text-slate-400 font-bold uppercase"></p>
                            <span id="quiz-score" class="text-orange-500 font-bold bg-orange-50 px-4 py-1.5 rounded-full text-sm">SCORE: 0</span>
                        </div>
                    </div>
                    <div id="quiz-area" class="text-center min-h-[140px] flex flex-col justify-center">
                        <!-- Dynamic Content -->
                    </div>
                    <div id="quiz-feedback" class="mt-8 text-center h-8 font-bold text-lg"></div>
                </div>
                <div id="quiz-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <!-- Quiz Result Stage -->
            <div id="quiz-result" class="hidden">
                <div class="screenshot-area shadow-2xl" id="final-report">
                    <div class="text-center mb-6">
                        <div class="text-6xl mb-4">ğŸ–ï¸</div>
                        <h2 class="text-3xl font-black text-slate-800">Lesson 5 æŒ‘æˆ°å ±å‘Š</h2>
                        <div class="w-16 h-1 bg-violet-500 mx-auto mt-2"></div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-slate-50 p-4 rounded-xl">
                            <p class="text-slate-400 text-xs font-bold uppercase mb-1">å­¸ç”Ÿå§“å</p>
                            <p id="res-name" class="text-xl font-black text-slate-700"></p>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-xl">
                            <p class="text-slate-400 text-xs font-bold uppercase mb-1">å®Œæˆæ—¥æœŸ</p>
                            <p id="res-date" class="text-xl font-black text-slate-700"></p>
                        </div>
                        <div class="bg-violet-500 p-4 rounded-xl col-span-2 text-center">
                            <p class="text-violet-100 text-xs font-bold uppercase mb-1">æœ€çµ‚å¾—åˆ† (Total Score)</p>
                            <p id="res-score" class="text-4xl font-black text-white"></p>
                        </div>
                    </div>

                    <p class="text-center text-slate-400 text-sm italic">ğŸ“¸ è«‹æˆªåœ–æ­¤ç•«é¢å‚³é€çµ¦è€å¸«é€²è¡Œæ ¸å°</p>
                </div>
                
                <div class="flex justify-center mt-8 space-x-4">
                    <button onclick="switchMode('list')" class="bg-slate-200 text-slate-600 px-8 py-3 rounded-full font-bold">è¿”å›ä¾‹å¥</button>
                    <button onclick="switchMode('quiz')" class="bg-violet-500 text-white px-8 py-3 rounded-full font-bold shadow-lg">é‡æ–°æŒ‘æˆ°</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        const rawData = [
            { id: 1, eng: "Parents are always **worried about** their children.", chunk: "worried about", chn: "çˆ¶æ¯ç¸½æ˜¯**æ“”å¿ƒ**ä»–å€‘çš„å­©å­ã€‚" },
            { id: 2, eng: "He works two jobs to **make a living**.", chunk: "make a living", chn: "ä»–åšå…©ä»½å·¥ä½œä¾†**è¬€ç”Ÿ**ã€‚" },
            { id: 3, eng: "Please **take a deep breath** and relax.", chunk: "take a deep breath", chn: "è«‹**æ·±å‘¼å¸**ä¸¦æ”¾é¬†ã€‚" },
            { id: 4, eng: "Many people **are afraid of** spiders.", chunk: "are afraid of", chn: "è¨±å¤šäºº**å®³æ€•**èœ˜è››ã€‚" },
            { id: 5, eng: "I didn't have breakfast because I was **in a hurry**.", chunk: "in a hurry", chn: "å› ç‚ºæˆ‘å¾ˆ**åŒ†å¿™**ï¼Œæ‰€ä»¥æ²’åƒæ—©é¤ã€‚" },
            { id: 6, eng: "You should **believe in** yourself.", chunk: "believe in", chn: "ä½ æ‡‰è©²**ç›¸ä¿¡**ä½ è‡ªå·±ã€‚" },
            { id: 7, eng: "Don't **give up on** your dreams so easily.", chunk: "give up on", chn: "ä¸è¦é€™éº¼è¼•æ˜“å°±**æ”¾æ£„**ä½ çš„å¤¢æƒ³ã€‚" },
            { id: 8, eng: "I still **keep in touch with** my elementary school friends.", chunk: "keep in touch with", chn: "æˆ‘ä»ç„¶èˆ‡æˆ‘åœ‹å°åŒå­¸**ä¿æŒè¯çµ¡**ã€‚" },
            { id: 9, eng: "Please **pay attention to** what the teacher is saying.", chunk: "pay attention to", chn: "è«‹**æ³¨æ„**è€å¸«æ­£åœ¨èªªçš„è©±ã€‚" },
            { id: 10, eng: "Who will **take care of** your cat while you're away?", chunk: "take care of", chn: "ä½ ä¸åœ¨æ™‚èª°æœƒ**ç…§é¡§**ä½ çš„è²“ï¼Ÿ" },
            { id: 11, eng: "I don't **agree with** your opinion on this matter.", chunk: "agree with", chn: "æˆ‘ä¸**åŒæ„**ä½ å°é€™ä»¶äº‹çš„çœ‹æ³•ã€‚" },
            { id: 12, eng: "English is spoken **all over the world**.", chunk: "all over the world", chn: "è‹±æ–‡åœ¨**å…¨ä¸–ç•Œ**éƒ½è¢«ä½¿ç”¨ã€‚" },
            { id: 13, eng: "He can sing and dance **at the same time**.", chunk: "at the same time", chn: "ä»–å¯ä»¥**åŒæ™‚**å”±æ­Œå’Œè·³èˆã€‚" },
            { id: 14, eng: "It's hard to **get used to** the cold weather here.", chunk: "get used to", chn: "å¾ˆé›£**ç¿’æ…£**é€™è£¡å¯’å†·çš„å¤©æ°£ã€‚" },
            { id: 15, eng: "We **look forward to** seeing you again.", chunk: "look forward to", chn: "æˆ‘å€‘**æœŸå¾…**å†æ¬¡è¦‹åˆ°ä½ ã€‚" },
            { id: 16, eng: "Cell phones are useful; **on the other hand**, they can be distracting.", chunk: "on the other hand", chn: "æ‰‹æ©Ÿå¾ˆæœ‰ç”¨ï¼›**å¦ä¸€æ–¹é¢**ï¼Œå®ƒå€‘ä¹Ÿå¯èƒ½è®“äººåˆ†å¿ƒã€‚" },
            { id: 17, eng: "Her grandfather **passed away** last night.", chunk: "passed away", chn: "å¥¹çš„ç¥–çˆ¶åœ¨æ˜¨æ™š**å»ä¸–**äº†ã€‚" },
            { id: 18, eng: "The company was **set up** ten years ago.", chunk: "set up", chn: "é€™é–“å…¬å¸æ˜¯åå¹´å‰**å‰µç«‹**çš„ã€‚" },
            { id: 19, eng: "**Thanks to** your help, we finished the project on time.", chunk: "Thanks to", chn: "**å¤šè™§äº†**ä½ çš„å¹«åŠ©ï¼Œæˆ‘å€‘æº–æ™‚å®Œæˆäº†è¨ˆç•«ã€‚" },
            { id: 20, eng: "Please call me back **as soon as possible**.", chunk: "as soon as possible", chn: "è«‹**ç›¡å¿«**å›é›»çµ¦æˆ‘ã€‚" },
            { id: 21, eng: "**By the way**, do you know where the library is?", chunk: "By the way", chn: "**é †å¸¶ä¸€æ**ï¼Œä½ çŸ¥é“åœ–æ›¸é¤¨åœ¨å“ªè£¡å—ï¼Ÿ" },
            { id: 22, eng: "She likes fruit, **for example**, apples and bananas.", chunk: "for example", chn: "å¥¹å–œæ­¡æ°´æœï¼Œ**ä¾‹å¦‚**ï¼šè˜‹æœå’Œé¦™è•‰ã€‚" },
            { id: 23, eng: "He looks young, but **in fact** he is over forty.", chunk: "in fact", chn: "**äº‹å¯¦ä¸Š**ä»–å·²ç¶“è¶…éå››åæ­²äº†ã€‚" },
            { id: 24, eng: "Don't **stay up late**, or you will be tired tomorrow.", chunk: "stay up late", chn: "ä¸è¦**ç†¬å¤œ**ï¼Œå¦å‰‡ä½ æ˜å¤©æœƒå¾ˆç´¯ã€‚" },
            { id: 25, eng: "Are you going to **take part in** the race?", chunk: "take part in", chn: "ä½ è¦**åƒåŠ **é€™å ´æ¯”è³½å—ï¼Ÿ" },
            { id: 26, eng: "My car **broke down** on the way to work.", chunk: "break down", chn: "æˆ‘çš„è»Šåœ¨ä¸Šç­è·¯ä¸Š**æ•…éšœ**äº†ã€‚" },
            { id: 27, eng: "We need to **come up with** a better plan.", chunk: "come up with", chn: "æˆ‘å€‘éœ€è¦**æƒ³å‡º**ä¸€å€‹æ›´å¥½çš„è¨ˆç•«ã€‚" },
            { id: 28, eng: "She knows how to **deal with** difficult customers.", chunk: "deal with", chn: "å¥¹çŸ¥é“å¦‚ä½•**è™•ç†**å¥§å®¢ã€‚" },
            { id: 29, eng: "Our success **depends on** how hard we work.", chunk: "depend on", chn: "æˆ‘å€‘çš„æˆåŠŸ**å–æ±ºæ–¼**æˆ‘å€‘æœ‰å¤šåŠªåŠ›ã€‚" }
        ];

        let currentIdx = 0;
        let score = 0;
        let quizPool = [];
        let userName = "";

        window.onload = () => {
            renderList();
        };

        function speak(text) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text.replace(/\*\*/g, ''));
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            window.speechSynthesis.speak(utterance);
        }

        function switchMode(mode) {
            document.querySelectorAll('.mode-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('mode-' + mode).classList.remove('hidden');
            
            document.querySelectorAll('nav button').forEach(el => el.classList.remove('tab-active', 'text-slate-500'));
            const activeBtn = document.getElementById('btn-mode-' + mode);
            activeBtn.classList.add('tab-active');

            if (mode === 'quiz') {
                document.getElementById('quiz-auth').classList.remove('hidden');
                document.getElementById('quiz-play').classList.add('hidden');
                document.getElementById('quiz-result').classList.add('hidden');
            }
        }

        function renderList() {
            const container = document.getElementById('list-container');
            container.innerHTML = "";
            rawData.forEach(item => {
                const htmlEng = item.eng.replace(/\*\*(.*?)\*\*/g, `<span class="chunk-highlight cursor-pointer" onclick="event.stopPropagation(); speak('$1')">$1</span>`);
                const htmlChn = item.chn.replace(/\*\*(.*?)\*\*/g, `<span class="text-violet-600 underline font-bold">$1</span>`);
                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-2xl border border-slate-100 card-shadow flex items-start space-x-4";
                card.innerHTML = `
                    <div class="mt-1 flex flex-col items-center">
                        <span class="text-xs font-black text-slate-300 mb-2">#${item.id}</span>
                        <button onclick="speak('${item.eng}')" class="p-2 bg-violet-50 rounded-full text-violet-500 hover:bg-violet-100 transition">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M160,32V224a8,8,0,0,1-12.91,6.31L77.25,176H32a16,16,0,0,1-16-16V96A16,16,0,0,1,32,80H77.25l69.84-54.31A8,8,0,0,1,160,32Z"></path></svg>
                        </button>
                    </div>
                    <div>
                        <p class="text-xl text-slate-800 font-medium leading-relaxed">${htmlEng}</p>
                        <p class="text-slate-400 text-sm mt-2 font-bold">${htmlChn}</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function initQuizSession() {
            const nameField = document.getElementById('student-name');
            if (!nameField.value.trim()) {
                nameField.classList.add('border-red-400');
                return;
            }
            userName = nameField.value.trim();
            document.getElementById('quiz-auth').classList.add('hidden');
            document.getElementById('quiz-play').classList.remove('hidden');
            document.getElementById('quiz-user-display').innerText = `Student: ${userName}`;
            startQuiz();
        }

        function startQuiz() {
            currentIdx = 0;
            score = 0;
            quizPool = [...rawData].sort(() => Math.random() - 0.5).slice(0, 10);
            updateQuiz();
        }

        function updateQuiz() {
            if (currentIdx >= quizPool.length) {
                showFinalReport();
                return;
            }
            const q = quizPool[currentIdx];
            document.getElementById('quiz-progress').innerText = `STEP ${currentIdx + 1}/10`;
            document.getElementById('quiz-score').innerText = `SCORE: ${score}`;
            document.getElementById('quiz-feedback').innerText = "";
            
            const area = document.getElementById('quiz-area');
            const displayQ = q.eng.replace(/\*\*(.*?)\*\*/g, '<span class="bg-violet-50 text-violet-50 px-3 py-1 rounded-lg border-b-2 border-violet-400 mx-1">__________</span>');
            
            area.innerHTML = `
                <p class="text-slate-400 text-sm mb-4 font-bold tracking-widest">${q.chn.replace(/<[^>]*>/g, '').replace(/\*\*/g, '')}</p>
                <h3 class="text-2xl md:text-3xl font-extrabold text-slate-800">${displayQ}</h3>
            `;

            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = "";
            
            let distractors = rawData
                .filter(d => d.chunk !== q.chunk)
                .map(d => d.chunk);
            
            distractors = [...new Set(distractors)].sort(() => Math.random() - 0.5).slice(0, 3);
            let allOptions = [q.chunk, ...distractors].sort(() => Math.random() - 0.5);
            
            allOptions.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "bg-white border-2 border-slate-100 p-5 rounded-2xl font-bold text-slate-600 hover:border-violet-400 hover:text-violet-600 hover:bg-violet-50 transition btn-check text-lg";
                btn.innerText = opt;
                btn.onclick = () => {
                    if(document.getElementById('quiz-feedback').innerText !== "") return;
                    check(opt, q.chunk, btn);
                };
                optionsContainer.appendChild(btn);
            });
        }

        function check(selected, correct, btn) {
            const feedback = document.getElementById('quiz-feedback');
            if (selected === correct) {
                score += 10;
                btn.classList.replace('border-slate-100', 'border-green-500');
                btn.classList.add('bg-green-50', 'text-green-600');
                feedback.innerHTML = "âœ… Correct!";
                feedback.className = "mt-8 text-center font-bold text-green-500 text-xl";
                speak(rawData.find(d => d.chunk === correct).eng);
            } else {
                btn.classList.replace('border-slate-100', 'border-red-500');
                btn.classList.add('bg-red-50', 'text-red-600');
                feedback.innerHTML = `âŒ Incorrect! It's <span class='underline'>${correct}</span>`;
                feedback.className = "mt-8 text-center font-bold text-red-500 text-xl";
            }
            
            setTimeout(() => {
                currentIdx++;
                updateQuiz();
            }, 1800);
        }

        function showFinalReport() {
            document.getElementById('quiz-play').classList.add('hidden');
            document.getElementById('quiz-result').classList.remove('hidden');
            
            document.getElementById('res-name').innerText = userName;
            document.getElementById('res-score').innerText = `${score} / 100`;
            
            const now = new Date();
            document.getElementById('res-date').innerText = `${now.getFullYear()}/${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
        }
    </script>
</body>
</html>